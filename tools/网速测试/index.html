<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no" />
<meta charset="UTF-8" />
<link rel="shortcut icon" href="favicon.ico">
<script type="text/javascript" src="speedtest.js"></script>
<script type="text/javascript">
function I(i){return document.getElementById(i);}
//INITIALIZE SPEEDTEST
var s=new Speedtest(); //create speedtest object
s.setParameter("telemetry_level","none"); //disable telemetry
s.setParameter("getIp_ispInfo",false);     //disable getispInfo 
s.setParameter("time_dl_max",5); //5 seconds for the download test
s.setParameter("time_ul_max",5); //5 seconds for the upload test

// 科技感配色方案
var meterBk = "rgba(30, 41, 59, 0.2)";
var dlColor = "rgba(56, 189, 248, 0.8)";
var ulColor = "rgba(16, 185, 129, 0.8)";
var progColor = "rgba(56, 189, 248, 0.5)";

// 仪表盘绘制函数
function drawMeter(c, amount, bk, fg, progress, prog) {
    var ctx = c.getContext("2d");
    var dp = window.devicePixelRatio || 1;
    var cw = c.clientWidth * dp, ch = c.clientHeight * dp;
    var sizScale = ch * 0.0055;
    
    // 处理高DPI显示
    if (c.width !== cw || c.height !== ch) {
        c.width = cw;
        c.height = ch;
    } else {
        ctx.clearRect(0, 0, cw, ch);
    }
    
    // 绘制背景圆环 - 带渐变效果增强科技感
    var bgGradient = ctx.createLinearGradient(0, 0, cw, ch);
    bgGradient.addColorStop(0, "rgba(30, 41, 59, 0.1)");
    bgGradient.addColorStop(1, "rgba(30, 41, 59, 0.3)");
    
    ctx.beginPath();
    ctx.strokeStyle = bgGradient;
    ctx.lineWidth = 12 * sizScale;
    ctx.lineCap = "round"; // 圆角线条增强现代感
    ctx.arc(c.width/2, c.height-58*sizScale, c.height/1.8 - ctx.lineWidth, -Math.PI*1.1, Math.PI*0.1);
    ctx.stroke();
    
    // 绘制前景圆环 - 带渐变效果
    var fgGradient = ctx.createLinearGradient(0, ch, cw, 0);
    fgGradient.addColorStop(0, fg);
    fgGradient.addColorStop(1, shadeColor(fg, 30));
    
    ctx.beginPath();
    ctx.strokeStyle = fgGradient;
    ctx.lineWidth = 12 * sizScale;
    ctx.lineCap = "round";
    ctx.arc(c.width/2, c.height-58*sizScale, c.height/1.8 - ctx.lineWidth, -Math.PI*1.1, amount*Math.PI*1.2 - Math.PI*1.1);
    ctx.stroke();
    
    // 绘制进度条
    if (typeof progress !== "undefined") {
        ctx.fillStyle = prog;
        ctx.fillRect(c.width*0.3, c.height-16*sizScale, c.width*0.4*progress, 4*sizScale);
    }
}

// 辅助函数：调整颜色亮度
function shadeColor(color, percent) {
    var R = parseInt(color.substring(5, 8), 16);
    var G = parseInt(color.substring(10, 13), 16);
    var B = parseInt(color.substring(15, 18), 16);

    R = parseInt(R * (100 + percent) / 100);
    G = parseInt(G * (100 + percent) / 100);
    B = parseInt(B * (100 + percent) / 100);

    R = (R < 255) ? R : 255;
    G = (G < 255) ? G : 255;
    B = (B < 255) ? B : 255;

    R = Math.round(R);
    G = Math.round(G);
    B = Math.round(B);

    var RR = ((R.toString(16).length === 1) ? "0" + R.toString(16) : R.toString(16));
    var GG = ((G.toString(16).length === 1) ? "0" + G.toString(16) : G.toString(16));
    var BB = ((B.toString(16).length === 1) ? "0" + B.toString(16) : B.toString(16));

    return "rgba(" + R + ", " + G + ", " + B + ", 0.8)";
}

function mbpsToAmount(s) {
    return 1 - (1 / (Math.pow(1.3, Math.sqrt(s))));
}

function format(d) {
    d = Number(d);
    if (d < 10) return d.toFixed(2);
    if (d < 100) return d.toFixed(1);
    return d.toFixed(0);
}

// UI 相关代码
var uiData = null;
function startStop() {
    if (s.getState() == 3) {
        // 终止测速
        s.abort();
        data = null;
        I("startStopBtn").className = "";
        initUI();
    } else {
        // 开始测速
        I("startStopBtn").className = "running";
        s.onupdate = function(data) {
            uiData = data;
        };
        s.onend = function(aborted) {
            I("startStopBtn").className = "";
            updateUI(true);
        };
        s.start();
    }
}

function updateUI(forced) {
    if (!forced && s.getState() != 3) return;
    if (uiData == null) return;
    
    var status = uiData.testState;
    I("ip").textContent = uiData.clientIp;
    
    // 下载速度显示
    I("dlText").textContent = (status == 1 && uiData.dlStatus == 0) ? "..." : format(uiData.dlStatus);
    drawMeter(I("dlMeter"), mbpsToAmount(Number(uiData.dlStatus * (status == 1 ? oscillate() : 1))), meterBk, dlColor, Number(uiData.dlProgress), progColor);
    
    // 上传速度显示
    I("ulText").textContent = (status == 3 && uiData.ulStatus == 0) ? "..." : format(uiData.ulStatus);
    drawMeter(I("ulMeter"), mbpsToAmount(Number(uiData.ulStatus * (status == 3 ? oscillate() : 1))), meterBk, ulColor, Number(uiData.ulProgress), progColor);
    
    // 延迟和抖动显示
    I("pingText").textContent = format(uiData.pingStatus);
    I("jitText").textContent = format(uiData.jitterStatus);
}

// 波动动画函数，增强科技感
function oscillate() {
    return 1 + 0.02 * Math.sin(Date.now() / 100);
}

// 动画帧更新
window.requestAnimationFrame = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.msRequestAnimationFrame || (function(callback) { setTimeout(callback, 1000/60); });

function frame() {
    requestAnimationFrame(frame);
    updateUI();
}
frame(); // 启动动画循环

// 初始化UI
function initUI() {
    drawMeter(I("dlMeter"), 0, meterBk, dlColor, 0);
    drawMeter(I("ulMeter"), 0, meterBk, ulColor, 0);
    I("dlText").textContent = "";
    I("ulText").textContent = "";
    I("pingText").textContent = "";
    I("jitText").textContent = "";
    I("ip").textContent = "";
}
</script>
<style type="text/css">
    :root {
        --primary: #38bdf8;
        --secondary: #10b981;
        --dark: #1e293b;
        --light: #f8fafc;
        --gray: #64748b;
        --shadow: 0 10px 25px -5px rgba(56, 189, 248, 0.1), 0 8px 10px -6px rgba(56, 189, 248, 0.1);
        --transition: all 0.3s ease;
    }
    
    html, body {
        border: none;
        padding: 0;
        margin: 0;
        background: #0f172a;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: var(--light);
        min-height: 100vh;
    }
    
    body {
        text-align: center;
        font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        padding: 20px;
        box-sizing: border-box;
    }
    
    .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px 0;
    }
    
    h1 {
        color: var(--light);
        font-weight: 700;
        margin-bottom: 30px;
        text-shadow: 0 2px 10px rgba(56, 189, 248, 0.3);
        position: relative;
        display: inline-block;
    }
    
    h1:after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 10%;
        width: 80%;
        height: 3px;
        background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }
    
    #startStopBtn {
        display: inline-block;
        margin: 0 auto 30px;
        color: var(--light);
        background: linear-gradient(135deg, var(--primary) 0%, #0ea5e9 100%);
        border: none;
        border-radius: 50px;
        transition: var(--transition);
        box-sizing: border-box;
        width: 12em;
        height: 3.5em;
        line-height: 3.5em;
        cursor: pointer;
        box-shadow: var(--shadow);
        font-weight: 600;
        font-size: 1.1em;
        position: relative;
        overflow: hidden;
    }
    
    #startStopBtn:before {
        content: "开始测速";
        position: relative;
        z-index: 2;
    }
    
    #startStopBtn.running:before {
        content: "终止测速";
    }
    
    #startStopBtn:hover {
        transform: translateY(-3px);
        box-shadow: 0 15px 30px -5px rgba(56, 189, 248, 0.2), 0 8px 10px -6px rgba(56, 189, 248, 0.2);
    }
    
    #startStopBtn.running {
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        box-shadow: 0 10px 25px -5px rgba(239, 68, 68, 0.2), 0 8px 10px -6px rgba(239, 68, 68, 0.2);
    }
    
    #startStopBtn.running:hover {
        box-shadow: 0 15px 30px -5px rgba(239, 68, 68, 0.3), 0 8px 10px -6px rgba(239, 68, 68, 0.3);
    }
    
    #test {
        margin-top: 2em;
    }
    
    .testGroup {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 30px;
        margin-bottom: 40px;
    }
    
    .testArea, .testArea2 {
        background: rgba(30, 41, 59, 0.5);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 20px;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }
    
    .testArea:hover, .testArea2:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 35px -10px rgba(56, 189, 248, 0.2);
    }
    
    .testArea {
        width: 280px;
        height: 220px;
        position: relative;
        box-sizing: border-box;
    }
    
    .testArea2 {
        width: 220px;
        height: 160px;
        position: relative;
        box-sizing: border-box;
        text-align: center;
    }
    
    .testName {
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 15px;
        font-size: 1.2em;
    }
    
    .testArea .testName {
        position: absolute;
        top: 20px;
        left: 0;
        width: 100%;
        z-index: 9;
    }
    
    .meterText {
        font-size: 2.5em;
        font-weight: 700;
        color: var(--light);
        transition: var(--transition);
    }
    
    .testArea .meterText {
        position: absolute;
        bottom: 40px;
        left: 0;
        width: 100%;
        z-index: 9;
    }
    
    .unit {
        color: var(--gray);
        font-size: 1em;
    }
    
    .testArea .unit {
        position: absolute;
        bottom: 20px;
        left: 0;
        width: 100%;
        z-index: 9;
    }
    
    .testArea canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }
    
    #ipArea {
        margin: 20px 0 30px;
        color: var(--gray);
        font-size: 0.9em;
    }
    
    #privacyPolicy {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 90%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(15px);
        border-radius: 15px;
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        z-index: 999999;
        text-align: left;
        padding: 30px;
        border: 1px solid rgba(56, 189, 248, 0.1);
        display: none;
    }
    
    #privacyPolicy h2 {
        color: var(--primary);
        margin-top: 0;
        border-bottom: 1px solid rgba(56, 189, 248, 0.2);
        padding-bottom: 15px;
    }
    
    #privacyPolicy h4 {
        color: var(--light);
    }
    
    #privacyPolicy ul {
        color: var(--light);
        line-height: 1.8;
    }
    
    .wechat-contact {
        color: var(--secondary);
        font-weight: 600;
    }
    
    a.privacy {
        color: var(--primary);
        text-decoration: none;
        font-size: 0.9em;
        transition: var(--transition);
        display: inline-block;
        margin-bottom: 20px;
    }
    
    a.privacy:hover {
        color: #0ea5e9;
        text-decoration: underline;
    }
    
    .closePrivacyPolicy {
        text-align: center;
        margin-top: 30px;
    }
    
    .closePrivacyPolicy a.privacy {
        background: var(--primary);
        color: var(--light);
        padding: 10px 25px;
        border-radius: 50px;
        margin-top: 20px;
    }
    
    .closePrivacyPolicy a.privacy:hover {
        background: #0ea5e9;
        text-decoration: none;
        transform: translateY(-2px);
    }
    
    .footer {
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid rgba(56, 189, 248, 0.1);
        color: var(--gray);
        font-size: 0.9em;
        line-height: 1.6;
    }
    
    .tech-support {
        color: var(--primary);
    }
    
    @media all and (max-width: 768px) {
        .testGroup {
            gap: 20px;
        }
        
        .testArea, .testArea2 {
            width: 100%;
            max-width: 300px;
        }
        
        h1 {
            font-size: 1.8em;
        }
    }
</style>
<title>测速|Flyz远征飞官网</title>
</head>
<body>
    <div class="container">
        <h1>Flyz远征飞官网 - 网络测速工具</h1>
        
        <div id="startStopBtn" onclick="startStop()"></div>
        
        <a class="privacy" href="#" onclick="I('privacyPolicy').style.display='block'">隐私说明</a>
        
        <div id="test">
            <div class="testGroup">
                <div class="testArea2">
                    <div class="testName">网络延迟</div>
                    <div id="pingText" class="meterText"></div>
                    <div class="unit">ms</div>
                </div>
                <div class="testArea2">
                    <div class="testName">延迟抖动</div>
                    <div id="jitText" class="meterText"></div>
                    <div class="unit">ms</div>
                </div>
            </div>
            
            <div class="testGroup">
                <div class="testArea">
                    <div class="testName">下载速度</div>
                    <canvas id="dlMeter" class="meter"></canvas>
                    <div id="dlText" class="meterText"></div>
                    <div class="unit">Mbps</div>
                </div>
                <div class="testArea">
                    <div class="testName">上传速度</div>
                    <canvas id="ulMeter" class="meter"></canvas>
                    <div id="ulText" class="meterText"></div>
                    <div class="unit">Mbps</div>
                </div>
            </div>
            
            <div id="ipArea">
                <span id="ip"></span>
            </div>
        </div>
        
        <div class="footer">
            <p>如有问题可添加微信: <span class="wechat-contact">YGWFK2024</span></p>
            <p>测速技术支持由 <span class="tech-support">中国科学技术大学</span> 提供</p>
        </div>
    </div>
    
    <div id="privacyPolicy">
        <h2>隐私说明</h2>
        <h4>本测速工具尊重并保护所有用户的个人隐私权，特此说明：</h4>
        <ul>
            <li>本网站所有测速过程均在本地完成，不收集、不存储任何用户数据</li>
            <li>测速结果仅在您的设备本地显示，不会上传至任何服务器</li>
            <li>我们不会获取您的个人身份信息、位置信息或其他敏感数据</li>
            <li>所有网络性能数据仅用于本次测速展示，刷新页面后将被清除</li>
            <li>如有任何疑问，可添加微信: <span class="wechat-contact">YGWFK2024</span> 咨询</li>
            <li>本测速工具使用中国科学技术大学提供的技术支持，但其不获取任何用户数据</li>
        </ul>
        <div class="closePrivacyPolicy">
            <a class="privacy" href="#" onclick="I('privacyPolicy').style.display='none'">关闭</a>
        </div>
    </div>
    
    <script type="text/javascript">
        setTimeout(function(){initUI()},100);
        // 初始化时不自动开始测速，让用户手动触发
    </script>
</body>
</html>
