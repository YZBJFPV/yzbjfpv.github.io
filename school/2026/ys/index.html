<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九年级六班 | 随机抽人</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 继承原页面核心配色，保持风格统一 */
        :root {
            --gold: #FFD700;
            --light-gold: #FFF8DC;
            --bright-gold: #FFE47F;
            --crimson: #8B0000;
            --light-crimson: #A52A2A;
            --dark-crimson: #5A0000;
            --glass: rgba(255, 255, 255, 0.2);
            --bg-main: #3a0f0f;
            --bg-gradient: linear-gradient(180deg, #6a1a1a, #3a0f0f, #2a0a0a);
            --card-shadow: 0 0 20px rgba(255,215,0,0.5);
            --card-shadow-active: 0 0 30px rgba(255,215,0,0.8);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            overflow: hidden;
            background: var(--bg-gradient);
            font-family: "PingFang SC", "Microsoft YaHei", "华文行楷", "华文楷体", "宋体", sans-serif;
            color: var(--light-gold);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            padding: 2vh 2vw;
        }

        /* 顶部恭喜区域 */
        .congrats-area {
            width: 100%;
            text-align: center;
            margin-top: 2vh;
            opacity: 0;
            transition: opacity 0.8s ease;
            z-index: 10;
        }
        .congrats-area.active {
            opacity: 1;
        }
        .congrats-title {
            font-family: "华文行楷";
            font-size: 4vw;
            background: linear-gradient(180deg, #fff, #ffd700, #ffE47F);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(0 0 15px rgba(255,215,0,0.8));
            letter-spacing: 0.5vw;
        }
        .congrats-names {
            font-size: 2.5vw;
            margin-top: 1vh;
            color: var(--bright-gold);
            text-shadow: 0 0 10px var(--crimson);
            letter-spacing: 0.3vw;
        }

        /* 人数选择区域 */
        .count-select-area {
            display: flex;
            gap: 1vw;
            justify-content: center;
            align-items: center;
            margin: 3vh 0;
            z-index: 10;
        }
        .count-title {
            font-size: 1.8vw;
            color: var(--light-gold);
            margin-right: 1vw;
            text-shadow: 0 0 5px var(--bright-gold);
        }
        .count-btn {
            width: 3.5vw;
            height: 3.5vw;
            border-radius: 50%;
            background: rgba(165, 42, 42, 0.3);
            border: 2px solid var(--bright-gold);
            color: var(--light-gold);
            font-size: 1.5vw;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: inset 0 0 5px rgba(255,215,0,0.3);
        }
        .count-btn:hover {
            transform: scale(1.1);
            box-shadow: var(--card-shadow);
        }
        .count-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffb800);
            color: var(--dark-crimson);
            box-shadow: var(--card-shadow-active);
        }

        /* 抽卡轮播区域（核心炫酷效果） */
        .card-carousel-area {
            width: 90vw;
            height: 25vh;
            position: relative;
            overflow: hidden;
            margin: 5vh 0;
            z-index: 10;
        }
        .carousel-container {
            display: flex;
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            transition: transform 0.05s linear; /* 轮播基础速度 */
        }
        .card-item {
            min-width: 18vw;
            height: 100%;
            margin: 0 1vw;
            background: linear-gradient(135deg, rgba(165, 42, 42, 0.8), rgba(90, 10, 10, 0.8));
            border: 3px solid var(--bright-gold);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "华文行楷";
            font-size: 2.8vw;
            color: var(--bright-gold);
            text-shadow: 0 0 10px var(--gold);
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
            transform: perspective(500px) rotateY(10deg);
            transition: all 0.5s ease;
        }
        .card-item:hover {
            transform: perspective(500px) rotateY(0deg) scale(1.05);
            box-shadow: var(--card-shadow-active);
        }
        .card-item.selected {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.6), rgba(255, 184, 0, 0.6));
            color: var(--dark-crimson);
            border-color: #fff;
            box-shadow: 0 0 30px rgba(255,255,255,0.7);
        }

        /* 结果合并展示区域 */
        .result-merge-area {
            width: 90vw;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5vw;
            justify-content: center;
            align-items: center;
            margin: 3vh 0;
            display: none;
            z-index: 10;
        }
        .result-card {
            width: 12vw;
            height: 10vh;
            background: linear-gradient(135deg, rgba(165, 42, 42, 0.9), rgba(90, 10, 10, 0.9));
            border: 2px solid var(--bright-gold);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "华文行楷";
            font-size: 1.8vw;
            color: var(--bright-gold);
            text-shadow: 0 0 8px var(--gold);
            box-shadow: var(--card-shadow);
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.5s ease;
        }
        .result-card.active {
            opacity: 1;
            transform: scale(1);
        }

        /* 控制按钮区域 */
        .control-btn-area {
            display: flex;
            gap: 3vw;
            margin-bottom: 5vh;
            z-index: 10;
        }
        .main-control-btn {
            padding: 1.5vw 3vw;
            border-radius: 50px;
            border: none;
            background: linear-gradient(135deg, #ffd700, #f5c518);
            color: var(--dark-crimson);
            font-family: "华文行楷";
            font-size: 2vw;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: var(--card-shadow);
        }
        .main-control-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--card-shadow-active);
            letter-spacing: 0.2vw;
        }
        .main-control-btn:disabled {
            background: rgba(165, 42, 42, 0.5);
            color: var(--light-gold);
            box-shadow: none;
            transform: none;
            cursor: not-allowed;
        }

        /* 加载状态提示 */
        .loading-area {
            position: fixed;
            inset: 0;
            background: var(--bg-gradient);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        .loading-text {
            font-family: "华文行楷";
            font-size: 3vw;
            color: var(--bright-gold);
            text-shadow: 0 0 15px var(--gold);
            margin-bottom: 3vh;
        }
        .loading-spinner {
            width: 5vw;
            height: 5vw;
            border: 3px solid rgba(255,215,0,0.3);
            border-top: 3px solid var(--bright-gold);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 背景点缀（增强炫酷感，匹配原页面风格） */
        .bg-decoration {
            position: fixed;
            inset: 0;
            z-index: 1;
            background: radial-gradient(circle at random 20% random 20%, rgba(255,215,0,0.1) 0%, transparent 10%),
                        radial-gradient(circle at random 80% random 40%, rgba(165,42,42,0.1) 0%, transparent 10%),
                        radial-gradient(circle at random 40% random 80%, rgba(255,215,0,0.1) 0%, transparent 10%);
            animation: bgShift 15s ease-in-out infinite;
        }
        @keyframes bgShift {
            0% { background-position: 0% 0%, 100% 100%, 0% 100%; }
            50% { background-position: 100% 100%, 0% 0%, 100% 0%; }
            100% { background-position: 0% 0%, 100% 100%, 0% 100%; }
        }

        /* 自适应适配（移动端/不同iframe尺寸） */
        @media screen and (max-width: 768px) {
            .congrats-title { font-size: 8vw; }
            .congrats-names { font-size: 5vw; }
            .count-title { font-size: 4vw; }
            .count-btn {
                width: 8vw;
                height: 8vw;
                font-size: 3vw;
            }
            .card-item {
                min-width: 35vw;
                font-size: 5vw;
            }
            .result-card {
                width: 25vw;
                height: 12vh;
                font-size: 4vw;
            }
            .main-control-btn {
                padding: 3vw 6vw;
                font-size: 4vw;
            }
            .loading-text { font-size: 6vw; }
            .loading-spinner {
                width: 10vw;
                height: 10vw;
            }
        }
    </style>
</head>
<body>
    <!-- 背景点缀 -->
    <div class="bg-decoration"></div>

    <!-- 加载状态 -->
    <div class="loading-area" id="loadingArea">
        <div class="loading-text">正在读取名单...</div>
        <div class="loading-spinner"></div>
    </div>

    <!-- 顶部恭喜区域 -->
    <div class="congrats-area" id="congratsArea">
        <div class="congrats-title" id="congratsTitle">恭喜以下同学！</div>
        <div class="congrats-names" id="congratsNames">—— 待抽取 ——</div>
    </div>

    <!-- 人数选择区域 -->
    <div class="count-select-area">
        <div class="count-title">选择抽取人数：</div>
        <div class="count-btn" data-count="1">1</div>
        <div class="count-btn" data-count="2">2</div>
        <div class="count-btn" data-count="3">3</div>
        <div class="count-btn" data-count="4">4</div>
        <div class="count-btn" data-count="5">5</div>
        <div class="count-btn" data-count="6">6</div>
        <div class="count-btn" data-count="7">7</div>
        <div class="count-btn" data-count="8">8</div>
        <div class="count-btn" data-count="9">9</div>
        <div class="count-btn" data-count="10">10</div>
    </div>

    <!-- 抽卡轮播区域 -->
    <div class="card-carousel-area" id="carouselArea">
        <div class="carousel-container" id="carouselContainer"></div>
    </div>

    <!-- 结果合并展示区域 -->
    <div class="result-merge-area" id="resultMergeArea"></div>

    <!-- 控制按钮区域 -->
    <div class="control-btn-area">
        <button class="main-control-btn" id="startDrawBtn" disabled>开始抽卡</button>
        <button class="main-control-btn" id="resetBtn" disabled>重置重抽</button>
    </div>

    <script>
        // 全局变量
        let nameList = []; // 完整名单
        let candidateList = []; // 候选名单（避免重复抽取）
        let selectedCount = 1; // 默认抽取1人
        let drawnNames = []; // 已抽取名单
        let isDrawing = false; // 是否正在抽卡
        let carouselTimer = null; // 轮播定时器
        let carouselSpeed = 5; // 轮播速度（数值越大越快）

        // DOM元素
        const loadingArea = document.getElementById('loadingArea');
        const congratsArea = document.getElementById('congratsArea');
        const congratsTitle = document.getElementById('congratsTitle');
        const congratsNames = document.getElementById('congratsNames');
        const countBtns = document.querySelectorAll('.count-btn');
        const carouselContainer = document.getElementById('carouselContainer');
        const carouselArea = document.getElementById('carouselArea');
        const resultMergeArea = document.getElementById('resultMergeArea');
        const startDrawBtn = document.getElementById('startDrawBtn');
        const resetBtn = document.getElementById('resetBtn');

        // 第一步：读取远程名单文件
        async function loadNameList() {
            try {
                const response = await fetch('https://yzbjfpv.top/school/2026/ys/name.txt');
                if (!response.ok) throw new Error('名单文件读取失败');
                const text = await response.text();
                // 处理文本：按换行分割，过滤空行和空白字符
                nameList = text.split('\n')
                    .map(name => name.trim())
                    .filter(name => name.length > 0);
                
                if (nameList.length === 0) throw new Error('名单为空，请检查文件内容');
                
                // 初始化候选名单
                candidateList = [...nameList];
                // 初始化界面
                initInterface();
                // 隐藏加载状态
                loadingArea.style.display = 'none';
            } catch (error) {
                loadingArea.innerHTML = `<div class="loading-text" style="color: #ff6b6b;">${error.message}</div>`;
                console.error('名单加载失败：', error);
            }
        }

        // 第二步：初始化界面
        function initInterface() {
            // 初始化人数选择按钮
            countBtns.forEach(btn => {
                // 超过名单总数的按钮禁用
                const count = parseInt(btn.dataset.count);
                if (count > nameList.length) {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    return;
                }

                btn.addEventListener('click', () => {
                    if (isDrawing) return;
                    countBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedCount = count;
                });
            });

            // 默认选中1人
            countBtns[0].classList.add('active');
            // 生成初始轮播卡片
            generateCarouselCards();
            // 启用控制按钮
            startDrawBtn.disabled = false;
            resetBtn.disabled = false;

            // 绑定控制按钮事件
            startDrawBtn.addEventListener('click', startDrawCard);
            resetBtn.addEventListener('click', resetDraw);
        }

        // 第三步：生成轮播卡片
        function generateCarouselCards() {
            carouselContainer.innerHTML = '';
            // 复制候选名单并打乱（增加随机性）
            const shuffledList = [...candidateList].sort(() => Math.random() - 0.5);
            // 生成卡片（重复2份，实现无缝轮播）
            const doubleList = [...shuffledList, ...shuffledList];
            doubleList.forEach(name => {
                const card = document.createElement('div');
                card.className = 'card-item';
                card.textContent = name;
                card.dataset.name = name;
                carouselContainer.appendChild(card);
            });
        }

        // 第四步：开始抽卡（核心动画逻辑）
        function startDrawCard() {
            if (isDrawing || candidateList.length < selectedCount) {
                alert('无法抽取：正在抽卡或剩余人数不足');
                return;
            }

            isDrawing = true;
            drawnNames = [];
            congratsArea.classList.remove('active');
            resultMergeArea.style.display = 'none';
            carouselArea.style.display = 'block';

            // 禁用按钮和人数选择
            startDrawBtn.disabled = true;
            countBtns.forEach(btn => btn.style.pointerEvents = 'none');

            // 初始化轮播速度
            carouselSpeed = 15;
            let carouselPosition = 0;
            let slowDownCount = 0;
            const maxSlowDownCount = selectedCount * 10; // 抽取人数越多，减速时间越长

            // 启动轮播
            carouselTimer = setInterval(() => {
                // 更新轮播位置
                carouselPosition += carouselSpeed;
                const cardWidth = document.querySelector('.card-item').offsetWidth + 20; // 卡片宽度+间距
                const maxPosition = carouselContainer.offsetWidth / 2;

                if (carouselPosition >= maxPosition) {
                    carouselPosition = 0;
                }

                carouselContainer.style.transform = `translateX(-${carouselPosition}px)`;

                // 开始减速
                if (slowDownCount >= maxSlowDownCount) {
                    carouselSpeed = Math.max(1, carouselSpeed - 0.5);
                } else {
                    slowDownCount++;
                }

                // 轮播停止条件（速度为0，且抽取足够人数）
                if (carouselSpeed <= 0 && drawnNames.length < selectedCount) {
                    clearInterval(carouselTimer);
                    // 选中当前中间位置的卡片
                    selectMiddleCard();
                }
            }, 20);
        }

        // 第五步：选中中间位置卡片
        function selectMiddleCard() {
            const cardWidth = document.querySelector('.card-item').offsetWidth + 20;
            const middlePosition = carouselArea.offsetWidth / 2 - cardWidth / 2;
            const cards = document.querySelectorAll('.card-item');
            let selectedCard = null;

            // 找到中间位置的卡片
            cards.forEach(card => {
                const cardRect = card.getBoundingClientRect();
                const carouselRect = carouselArea.getBoundingClientRect();
                const cardMiddle = cardRect.left + cardRect.width / 2;
                const carouselMiddle = carouselRect.left + carouselRect.width / 2;

                if (Math.abs(cardMiddle - carouselMiddle) < cardWidth / 2) {
                    selectedCard = card;
                }
            });

            if (selectedCard && !drawnNames.includes(selectedCard.dataset.name)) {
                // 高亮选中卡片
                selectedCard.classList.add('selected');
                // 添加到已抽取名单
                const selectedName = selectedCard.dataset.name;
                drawnNames.push(selectedName);
                // 从候选名单中移除（避免重复）
                candidateList = candidateList.filter(name => name !== selectedName);

                // 延迟后继续抽卡（如果未抽够人数）
                setTimeout(() => {
                    selectedCard.classList.remove('selected');
                    if (drawnNames.length < selectedCount) {
                        // 重新生成轮播卡片（更新候选名单）
                        generateCarouselCards();
                        // 继续抽卡
                        startDrawCard();
                    } else {
                        // 抽卡完成，展示结果
                        showMergeResult();
                    }
                }, 800);
            } else {
                // 重复选中，重新抽卡
                generateCarouselCards();
                startDrawCard();
            }
        }

        // 第六步：展示合并结果
        function showMergeResult() {
            isDrawing = false;
            // 隐藏轮播区域，显示结果区域
            carouselArea.style.display = 'none';
            resultMergeArea.style.display = 'flex';
            resultMergeArea.innerHTML = '';

            // 更新恭喜文案
            congratsArea.classList.add('active');
            if (drawnNames.length === 1) {
                congratsTitle.textContent = `恭喜 ${drawnNames[0]} 同学！`;
                congratsNames.textContent = '荣获本次幸运名额～';
            } else {
                congratsTitle.textContent = '恭喜以下同学！';
                congratsNames.textContent = drawnNames.join('、');
            }

            // 生成结果卡片（逐一入场动画）
            drawnNames.forEach((name, index) => {
                const resultCard = document.createElement('div');
                resultCard.className = 'result-card';
                resultCard.textContent = name;
                resultMergeArea.appendChild(resultCard);

                // 逐一激活动画
                setTimeout(() => {
                    resultCard.classList.add('active');
                }, index * 200);
            });

            // 启用按钮和人数选择
            startDrawBtn.disabled = false;
            countBtns.forEach(btn => {
                if (parseInt(btn.dataset.count) <= nameList.length) {
                    btn.style.pointerEvents = 'auto';
                }
            });
        }

        // 第七步：重置重抽
        function resetDraw() {
            if (isDrawing) return;

            // 恢复初始状态
            drawnNames = [];
            candidateList = [...nameList];
            congratsArea.classList.remove('active');
            resultMergeArea.style.display = 'none';
            carouselArea.style.display = 'block';

            // 重新生成轮播卡片
            generateCarouselCards();
            // 重置恭喜文案
            congratsTitle.textContent = '恭喜以下同学！';
            congratsNames.textContent = '—— 待抽取 ——';
        }

        // 页面加载完成后读取名单
        window.onload = loadNameList;
    </script>
</body>
</html>
