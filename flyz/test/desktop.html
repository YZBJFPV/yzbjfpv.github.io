<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flyz远征飞智能桌面系统</title>
  <!-- 引入第三方资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  <!-- Tailwind自定义配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tech: {
              blue: '#165DFF',
              purple: '#722ED1',
              warm: '#FF7D00',
            },
            warm: {
              100: '#FFF8E6',
              200: '#FFEDCC'
            }
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .text-shadow { text-shadow: 0 2px 10px rgba(0,0,0,0.15); }
      .text-shadow-lg { text-shadow: 0 4px 20px rgba(0,0,0,0.25); }
      .bg-blur { backdrop-filter: blur(8px); }
      .animate-float { animation: float 6s ease-in-out infinite; }
      .animate-pulse-slow { animation: pulse 4s cubic-bezier(0.4,0,0.6,1) infinite; }
      .animate-gradient { animation: gradient 15s ease infinite; }
      .animate-cloud { animation: cloudMove 30s linear infinite; }
      .animate-star { animation: starTwinkle 3s ease-in-out infinite; }
      .animate-rain { animation: rainFall 1s linear infinite; }
      .animate-snow { animation: snowFall 5s linear infinite; }
    }

    /* 核心动画定义 */
    @keyframes float {
      0%,100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }
    @keyframes gradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes cloudMove {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(1920px); }
    }
    @keyframes starTwinkle {
      0%,100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
    @keyframes rainFall {
      0% { transform: translateY(-20px); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(1080px); opacity: 0; }
    }
    @keyframes snowFall {
      0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(1080px) rotate(360deg); opacity: 0; }
    }

    /* 基础样式 */
    body {
      overflow: hidden;
      touch-action: none;
      user-select: none;
    }
    .weather-icon { filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1)); }
    .particle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.7;
    }
    .weather-effect-item {
      position: absolute;
      pointer-events: none;
    }
  </style>
</head>
<body class="w-screen h-screen overflow-hidden font-sans">
  <!-- 动态背景容器 -->
  <div id="background" class="fixed inset-0 bg-gradient-to-br from-tech-blue/90 to-tech-purple/90 animate-gradient bg-[length:400%_400%] transition-all duration-10000 ease-in-out">
    <div id="particles" class="fixed inset-0"></div>
    <div id="weather-effects" class="fixed inset-0 pointer-events-none"></div>
    <div class="fixed inset-0 bg-radial-gradient(circle at center, transparent 60%, rgba(255,255,255,0.05) 100%) animate-pulse-slow"></div>
  </div>

  <!-- 主内容容器 -->
  <div class="relative w-full h-full flex flex-col justify-between p-8 md:p-12">
    <!-- 左上角Logo -->
    <div class="flex items-center z-10">
      <img src="https://www.img520.com/UIGuUV.jpeg" alt="Flyz Logo" class="w-16 h-16 md:w-20 md:h-20 object-contain rounded-lg shadow-lg animate-pulse-slow">
    </div>

    <!-- 中间时钟区域 -->
    <div class="flex flex-col items-center justify-center z-10 space-y-6">
      <div class="text-center">
        <div id="time" class="text-[clamp(4rem,15vw,10rem)] font-bold text-white text-shadow-lg leading-none transition-all duration-300">
          00:00:00
        </div>
        <div id="date" class="text-[clamp(1rem,3vw,1.5rem)] text-warm-100 text-shadow mt-2">
          2025年1月1日 星期一
        </div>
      </div>
            <!-- 天气卡片 -->
      <div id="weather-card" class="bg-white/10 bg-blur rounded-2xl p-6 md:p-8 backdrop-blur-md shadow-xl border border-white/20 transition-all duration-500 hover:shadow-2xl hover:scale-105 animate-float w-full max-w-md">
        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
          <!-- 天气图标与定位信息 -->
          <div class="flex items-center gap-4">
            <i id="weather-icon" class="fa fa-sun-o text-[clamp(2.5rem,8vw,4rem)] text-warm-200 weather-icon animate-float"></i>
            <div>
              <div id="location" class="text-[clamp(1rem,2vw,1.25rem)] text-white text-shadow">
                定位中...
              </div>
              <div id="weather-desc" class="text-[clamp(0.9rem,1.8vw,1.1rem)] text-warm-100">
                加载天气信息...
              </div>
            </div>
          </div>
          <!-- 温度与环境信息 -->
          <div class="flex items-end gap-2">
            <div id="temperature" class="text-[clamp(2.5rem,8vw,4rem)] font-bold text-white text-shadow-lg">
              --°C
            </div>
            <div class="flex flex-col items-end pb-2">
              <div id="temp-range" class="text-[clamp(0.8rem,1.6vw,1rem)] text-warm-100">
                --°C / --°C
              </div>
              <div id="humidity" class="text-[clamp(0.8rem,1.6vw,1rem)] text-warm-100 flex items-center gap-1">
                <i class="fa fa-tint"></i> --%
              </div>
              <div id="wind" class="text-[clamp(0.8rem,1.6vw,1rem)] text-warm-100 flex items-center gap-1">
                <i class="fa fa-location-arrow"></i> -- 级
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 右下角版本信息 -->
    <div class="text-right z-10">
      <div class="text-gray-400 text-[clamp(0.8rem,1.5vw,1rem)]">
        Flyz远征飞智能桌面系统_V1.0.1版
      </div>
    </div>
  </div>

  <script>
    // 1. 核心配置（15秒天气更新）
    const config = {
      weatherApiKey: '561c48e8d36747d19e0105744251205', // 和风天气API（稳定高频）
      particleCount: 80,
      updateInterval: 1000, // 时钟每秒更新
      weatherUpdateInterval: 15 * 1000, // 天气15秒更新
      effectUpdateInterval: 5000 // 特效5秒切换
    };

    // 2. 天气类型映射配置
    const weatherConfig = {
      sunny: {
        icon: 'fa-sun-o',
        color: '#FF7D00',
        bg: 'from-warm-200/90 to-tech-warm/80',
        particleColor: 'rgba(255,193,7,0.3)',
        effect: 'sun'
      },
      cloudy: {
        icon: 'fa-cloud',
        color: '#90A4AE',
        bg: 'from-gray-200/90 to-gray-400/80',
        particleColor: 'rgba(156,163,175,0.3)',
        effect: 'cloud'
      },
      rainy: {
        icon: 'fa-tint',
        color: '#42A5F5',
        bg: 'from-tech-blue/90 to-blue-700/80',
        particleColor: 'rgba(66,165,245,0.3)',
        effect: 'rain'
      },
      snowy: {
        icon: 'fa-snowflake-o',
        color: '#E0F2FE',
        bg: 'from-blue-50/90 to-blue-100/80',
        particleColor: 'rgba(224,242,254,0.5)',
        effect: 'snow'
      },
      stormy: {
        icon: 'fa-bolt',
        color: '#7986CB',
        bg: 'from-gray-700/90 to-gray-900/80',
        particleColor: 'rgba(121,134,203,0.3)',
        effect: 'storm'
      },
      foggy: {
        icon: 'fa-cloud',
        color: '#ECEFF1',
        bg: 'from-gray-100/90 to-gray-200/80',
        particleColor: 'rgba(224,224,224,0.4)',
        effect: 'fog'
      },
      windy: {
        icon: 'fa-wind',
        color: '#B0BEC5',
        bg: 'from-gray-200/90 to-blue-200/80',
        particleColor: 'rgba(176,190,197,0.3)',
        effect: 'wind'
      },
      default: {
        icon: 'fa-question-circle',
        color: '#90A4AE',
        bg: 'from-tech-blue/90 to-tech-purple/90',
        particleColor: 'rgba(96,125,139,0.3)',
        effect: 'default'
      }
    };

    // 3. 工具函数库
    const utils = {
      // 天气代码映射类型
      getWeatherType: (code) => {
        code = parseInt(code);
        if (code >= 100 && code <= 103) return 'sunny';
        if (code >= 200 && code <= 213) return 'cloudy';
        if (code >= 300 && code <= 321) return 'rainy';
        if (code >= 400 && code <= 407) return 'snowy';
        if (code >= 500 && code <= 531) return 'rainy';
        if (code >= 600 && code <= 622) return 'snowy';
        if (code >= 700 && code <= 799) return 'foggy';
        if (code >= 800 && code <= 801) return 'sunny';
        if (code >= 802 && code <= 804) return 'cloudy';
        if (code >= 900 && code <= 999) return 'windy';
        return 'default';
      },

      // 生成动态粒子
      createParticles: (count) => {
        const container = document.getElementById('particles');
        container.innerHTML = '';
        for (let i = 0; i < count; i++) {
          const particle = document.createElement('div');
          const size = Math.random() * 12 + 2;
          const x = Math.random() * 100;
          const y = Math.random() * 100;
          const delay = Math.random() * 5;
          const duration = Math.random() * 15 + 10;
          const opacity = Math.random() * 0.5 + 0.2;
          
          particle.className = 'particle animate-float';
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.left = `${x}%`;
          particle.style.top = `${y}%`;
          particle.style.animationDelay = `${delay}s`;
          particle.style.animationDuration = `${duration}s`;
          particle.style.opacity = opacity;
          
          container.appendChild(particle);
        }
      },

      // 更新粒子颜色
      updateParticleColor: (color) => {
        document.querySelectorAll('.particle').forEach(p => {
          p.style.backgroundColor = color;
        });
      },

      // 生成天气特效
      createWeatherEffect: (type) => {
        const container = document.getElementById('weather-effects');
        container.innerHTML = '';
        
        switch(type) {
          case 'sun':
            // 阳光特效
            for (let i = 0; i < 12; i++) {
              const ray = document.createElement('div');
              const angle = (i * 30) * Math.PI / 180;
              const length = Math.random() * 50 + 30;
              const x = 50 + Math.cos(angle) * 100;
              const y = 50 + Math.sin(angle) * 100;
              
              ray.className = 'weather-effect-item';
              ray.style.width = `${length}px`;
              ray.style.height = '2px';
              ray.style.backgroundColor = 'rgba(255,255,255,0.3)';
              ray.style.left = `${x}%`;
              ray.style.top = `${y}%`;
              ray.style.transformOrigin = 'left center';
              ray.style.transform = `rotate(${angle}rad)`;
              ray.style.animation = `pulse 3s ease-in-out infinite ${Math.random() * 2}s`;
              
              container.appendChild(ray);
            }
            break;

          case 'cloud':
            // 云朵特效
            for (let i = 0; i < 3; i++) {
              const cloud = document.createElement('i');
              const size = Math.random() * 40 + 60;
              const x = Math.random() * 100;
              const y = Math.random() * 30 + 20;
              const delay = Math.random() * 10;
              
              cloud.className = 'fa fa-cloud weather-effect-item animate-cloud';
              cloud.style.fontSize = `${size}px`;
              cloud.style.color = 'rgba(255,255,255,0.6)';
              cloud.style.left = `${x}%`;
              cloud.style.top = `${y}%`;
              cloud.style.animationDelay = `${delay}s`;
              cloud.style.animationDuration = `${30 + Math.random() * 20}s`;
              
              container.appendChild(cloud);
            }
            break;

          case 'rain':
            // 雨滴特效
            for (let i = 0; i < 50; i++) {
              const rain = document.createElement('div');
              const width = Math.random() * 2 + 1;
              const height = Math.random() * 15 + 10;
              const x = Math.random() * 100;
              const y = Math.random() * 100;
              const delay = Math.random() * 2;
              
              rain.className = 'weather-effect-item animate-rain';
              rain.style.width = `${width}px`;
              rain.style.height = `${height}px`;
              rain.style.backgroundColor = 'rgba(144,202,249,0.7)';
              rain.style.left = `${x}%`;
              rain.style.top = `${y}%`;
              rain.style.borderRadius = '3px';
              rain.style.animationDelay = `${delay}s`;
              
              container.appendChild(rain);
            }
            break;

          case 'snow':
            // 雪花特效
            for (let i = 0; i < 60; i++) {
              const snow = document.createElement('i');
              const size = Math.random() * 15 + 10;
              const x = Math.random() * 100;
              const y = Math.random() * 100;
              const delay = Math.random() * 5;
              
              snow.className = 'fa fa-snowflake-o weather-effect-item animate-snow';
              snow.style.fontSize = `${size}px`;
              snow.style.color = 'rgba(255,255,255,0.8)';
              snow.style.left = `${x}%`;
              snow.style.top = `${y}%`;
              snow.style.animationDelay = `${delay}s`;
              snow.style.animationDuration = `${5 + Math.random() * 3}s`;
              
              container.appendChild(snow);
            }
            break;

          default:
            break;
        }
      }
    };
        // 4. 核心功能实现
    const app = {
      // 初始化应用
      init: () => {
        app.initParticles();
        app.initClock();
        app.getLocation();
        // 定时任务
        setInterval(app.updateClock, config.updateInterval);
        setInterval(app.updateWeather, config.weatherUpdateInterval);
        setInterval(() => {
          const currentWeather = document.getElementById('weather-icon').dataset.type || 'default';
          utils.createWeatherEffect(currentWeather);
        }, config.effectUpdateInterval);
      },

      // 初始化粒子背景
      initParticles: () => {
        utils.createParticles(config.particleCount);
        utils.updateParticleColor(weatherConfig.default.particleColor);
      },

      // 初始化时钟
      initClock: () => {
        app.updateClock();
        app.updateDate();
      },

      // 更新实时时钟（带呼吸动画）
      updateClock: () => {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const timeEl = document.getElementById('time');
        
        timeEl.textContent = `${hours}:${minutes}:${seconds}`;
        // 数字呼吸效果
        timeEl.style.transform = `scale(${1 + Math.sin(now.getSeconds() * 0.1) * 0.02})`;
        timeEl.style.opacity = 0.9 + Math.sin(now.getSeconds() * 0.1) * 0.1;
      },

      // 更新日期
      updateDate: () => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const weekdays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
        const weekday = weekdays[now.getDay()];
        document.getElementById('date').textContent = `${year}年${month}月${day}日 ${weekday}`;
      },

      // 获取定位（精准定位）
      getLocation: () => {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            (pos) => app.getWeatherByLocation(pos.coords.latitude, pos.coords.longitude),
            (err) => {
              console.error('定位失败:', err);
              document.getElementById('location').textContent = '定位未授权';
              //  fallback：使用IP定位
              app.getWeatherByIP();
            },
            {
              enableHighAccuracy: true, // 高精度定位
              timeout: 10000, // 10秒超时
              maximumAge: 0 // 不使用缓存
            }
          );
        } else {
          document.getElementById('location').textContent = '浏览器不支持定位';
          app.getWeatherByIP();
        }
      },

      // IP定位 fallback
      getWeatherByIP: () => {
        fetch('https://api.ipify.org?format=json')
          .then(res => res.json())
          .then(data => {
            const ip = data.ip;
            // 通过IP获取地理位置
            fetch(`https://api.ipapi.co/${ip}/json/`)
              .then(res => res.json())
              .then(locData => {
                const lat = locData.latitude;
                const lon = locData.longitude;
                if (lat && lon) {
                  app.getWeatherByLocation(lat, lon);
                } else {
                  document.getElementById('location').textContent = '未知位置';
                  app.getDefaultWeather();
                }
              })
              .catch(() => {
                document.getElementById('location').textContent = '未知位置';
                app.getDefaultWeather();
              });
          })
          .catch(() => {
            document.getElementById('location').textContent = '未知位置';
            app.getDefaultWeather();
          });
      },

      // 默认天气（无定位时使用）
      getDefaultWeather: () => {
        document.getElementById('weather-icon').className = 'fa fa-sun-o text-[clamp(2.5rem,8vw,4rem)] text-warm-200 weather-icon animate-float';
        document.getElementById('weather-icon').dataset.type = 'sunny';
        document.getElementById('temperature').textContent = 'N/A°C';
        document.getElementById('temp-range').textContent = 'N/A°C / N/A°C';
        document.getElementById('humidity').textContent = 'N/A%';
        document.getElementById('wind').textContent = 'N/A 级';
        document.getElementById('weather-desc').textContent = 'N/A';
        // 更新背景和粒子
        app.updateBackground('sunny');
        utils.createWeatherEffect('sunny');
      },

      // 通过经纬度获取天气（15秒更新）
      getWeatherByLocation: (lat, lon) => {
        const url = `https://devapi.qweather.com/v7/weather/now?location=${lon},${lat}&key=${config.weatherApiKey}`;
        
        fetch(url)
          .then(res => {
            if (!res.ok) throw new Error('天气接口请求失败');
            return res.json();
          })
          .then(data => {
            if (data.code !== '200') throw new Error('天气数据获取失败');
            app.updateWeatherUI(data);
            // 获取城市名称
            app.getCityName(lat, lon);
          })
          .catch(err => {
            console.error('天气更新失败:', err);
            // 失败时保留上次数据，不影响显示
          });
      },

      // 获取城市名称（精准定位显示）
      getCityName: (lat, lon) => {
        const url = `https://devapi.qweather.com/v7/geo/reverse?location=${lon},${lat}&key=${config.weatherApiKey}`;
        
        fetch(url)
          .then(res => res.json())
          .then(data => {
            if (data.code === '200' && data.address) {
              const city = data.address.city || data.address.province || '未知城市';
              const district = data.address.district || '';
              document.getElementById('location').textContent = `${city}${district}`;
            }
          })
          .catch(err => console.error('城市名称获取失败:', err));
      },

      // 定时更新天气（15秒一次）
      updateWeather: () => {
        const location = document.getElementById('location').textContent;
        if (location !== '定位中...' && location !== '定位未授权' && location !== '未知位置') {
          // 重新获取定位（确保位置精准）
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
              (pos) => app.getWeatherByLocation(pos.coords.latitude, pos.coords.longitude),
              (err) => {
                console.error('更新定位失败:', err);
                // 继续使用上次经纬度（如果有）
                if (app.lastLat && app.lastLon) {
                  app.getWeatherByLocation(app.lastLat, app.lastLon);
                }
              },
              { enableHighAccuracy: false, timeout: 5000, maximumAge: 30000 }
            );
          }
        }
      },

      // 更新天气UI显示
      updateWeatherUI: (data) => {
        const now = data.now;
        const weatherType = utils.getWeatherType(now.icon);
        const config = weatherConfig[weatherType];
        
        // 保存经纬度用于后续更新
        app.lastLat = data.location.lat;
        app.lastLon = data.location.lon;
        
        // 更新图标
        const iconEl = document.getElementById('weather-icon');
        iconEl.className = `fa ${config.icon} text-[clamp(2.5rem,8vw,4rem)] text-${config.color} weather-icon animate-float`;
        iconEl.dataset.type = weatherType;
        
        // 更新温度和描述
        document.getElementById('temperature').textContent = `${now.temp}°C`;
        document.getElementById('weather-desc').textContent = now.text;
        document.getElementById('humidity').textContent = `${now.humidity}%`;
        document.getElementById('wind').textContent = `${now.windScale} 级`;
        
        // 获取预报数据（最高最低温）
        app.getForecast(data.location.lon, data.location.lat);
        
        // 更新背景和粒子
        app.updateBackground(weatherType);
        utils.createWeatherEffect(weatherType);
      },

      // 获取预报数据（最高最低温）
      getForecast: (lon, lat) => {
        const url = `https://devapi.qweather.com/v7/weather/3d?location=${lon},${lat}&key=${config.weatherApiKey}`;
        
        fetch(url)
          .then(res => res.json())
          .then(data => {
            if (data.code === '200') {
              const today = data.daily[0];
              document.getElementById('temp-range').textContent = `${today.tempMin}°C / ${today.tempMax}°C`;
            }
          })
          .catch(err => console.error('预报数据获取失败:', err));
      },

      // 根据天气更新背景
      updateBackground: (weatherType) => {
        const config = weatherConfig[weatherType];
        const bgEl = document.getElementById('background');
        
        // 更新背景渐变
        bgEl.className = `fixed inset-0 bg-gradient-to-br ${config.bg} animate-gradient bg-[length:400%_400%] transition-all duration-10000 ease-in-out`;
        
        // 更新粒子颜色
        utils.updateParticleColor(config.particleColor);
        
        // 背景亮度调整
        switch(weatherType) {
          case 'stormy':
          case 'foggy':
            bgEl.style.filter = 'brightness(0.8)';
            break;
          case 'sunny':
            bgEl.style.filter = 'brightness(1.1)';
            break;
          default:
            bgEl.style.filter = 'brightness(1)';
            break;
        }
      }
    };

    // 5. 页面加载完成后初始化
    window.addEventListener('load', () => {
      // 预加载天气特效资源
      app.init();
      
      // 额外添加页面加载动画
      const body = document.body;
      body.style.opacity = 0;
      body.style.transition = 'opacity 2s ease-in-out';
      
      setTimeout(() => {
        body.style.opacity = 1;
      }, 500);
    });
        // 6. 增强动态交互效果（无点击也有持续动画）
    const dynamicEffects = {
      // 随机粒子浮动方向变化
      randomizeParticleDirection: () => {
        setInterval(() => {
          document.querySelectorAll('.particle').forEach(particle => {
            const xDir = Math.random() * 0.5 - 0.25;
            const yDir = Math.random() * 0.5 - 0.25;
            particle.style.transform = `translate(${xDir}px, ${yDir}px) translateY(-15px)`;
          });
        }, 3000);
      },

      // 天气卡片呼吸效果
      cardBreathingEffect: () => {
        const card = document.getElementById('weather-card');
        setInterval(() => {
          const scale = 1 + Math.random() * 0.03;
          const opacity = 0.9 + Math.random() * 0.1;
          card.style.transform = `scale(${scale})`;
          card.style.opacity = opacity;
        }, 5000);
      },

      // 背景光效流动
      backgroundLightFlow: () => {
        const bg = document.getElementById('background');
        let angle = 0;
        setInterval(() => {
          angle += 0.01;
          const x = 50 + Math.sin(angle) * 20;
          const y = 50 + Math.cos(angle) * 20;
          bg.insertAdjacentHTML('beforeend', `
            <div class="fixed inset-0 bg-radial-gradient(circle at ${x}% ${y}%, transparent 60%, rgba(255,255,255,0.03) 100%) pointer-events-none"></div>
          `);
          // 移除旧光效
          const lights = document.querySelectorAll('.bg-radial-gradient');
          if (lights.length > 2) lights[0].remove();
        }, 1000);
      },

      // 时钟数字光影变化
      clockLightEffect: () => {
        const timeEl = document.getElementById('time');
        setInterval(() => {
          const hue = Math.floor(Math.random() * 60) + 20; // 暖色调范围
          timeEl.style.textShadow = `0 0 15px rgba(${255 - hue}, ${200 + hue/2}, ${100 + hue}, 0.3)`;
        }, 4000);
      },

      // 初始化所有动态效果
      init: () => {
        dynamicEffects.randomizeParticleDirection();
        dynamicEffects.cardBreathingEffect();
        dynamicEffects.backgroundLightFlow();
        dynamicEffects.clockLightEffect();
      }
    };

    // 7. 性能优化与容错处理
    const performanceOptimization = {
      // 节流函数（防止高频触发）
      throttle: (func, delay) => {
        let lastCall = 0;
        return (...args) => {
          const now = Date.now();
          if (now - lastCall >= delay) {
            lastCall = now;
            func(...args);
          }
        };
      },

      // 防抖函数（防止重复触发）
      debounce: (func, delay) => {
        let timeoutId;
        return (...args) => {
          clearTimeout(timeoutId);
          timeoutId = setTimeout(() => func(...args), delay);
        };
      },

      // 检测设备性能，调整动画强度
      adjustAnimationIntensity: () => {
        const performance = window.performance || { now: () => Date.now() };
        const start = performance.now();
        
        // 简单性能测试
        for (let i = 0; i < 1000; i++) Math.sqrt(i);
        
        const end = performance.now();
        const duration = end - start;
        
        // 低性能设备降低粒子数量和动画频率
        if (duration > 5) {
          config.particleCount = 40;
          config.effectUpdateInterval = 8000;
          document.querySelectorAll('.particle').forEach((p, i) => {
            if (i >= 40) p.remove();
          });
        }
      },

      // 网络状态监听，离线时切换本地默认效果
      monitorNetworkStatus: () => {
        window.addEventListener('online', () => {
          document.getElementById('weather-desc').textContent = '网络已恢复，正在更新天气...';
          setTimeout(() => app.updateWeather(), 1000);
        });

        window.addEventListener('offline', () => {
          document.getElementById('weather-desc').textContent = '离线模式，显示缓存天气';
          // 保持本地动态效果正常运行
          const currentWeather = document.getElementById('weather-icon').dataset.type || 'default';
          utils.createWeatherEffect(currentWeather);
        });
      },

      // 初始化性能优化
      init: () => {
        performanceOptimization.adjustAnimationIntensity();
        performanceOptimization.monitorNetworkStatus();
        // 重写高频函数为节流版本
        app.updateWeather = performanceOptimization.throttle(app.updateWeather, config.weatherUpdateInterval - 1000);
      }
    };

    // 8. 扩展功能：屏幕触摸唤醒效果（可选触发）
    const touchWakeEffect = {
      init: () => {
        let lastTapTime = 0;
        const body = document.body;
        
        body.addEventListener('touchstart', (e) => {
          const now = Date.now();
          const tapLength = now - lastTapTime;
          
          // 双击唤醒特效
          if (tapLength < 300 && tapLength > 0) {
            touchWakeEffect.showWakeEffect(e.touches[0].clientX, e.touches[0].clientY);
            clearTimeout(touchWakeEffect.tapTimeout);
          } else {
            touchWakeEffect.tapTimeout = setTimeout(() => lastTapTime = 0, 300);
          }
          lastTapTime = now;
        });

        // 鼠标点击模拟触摸效果（调试用）
        body.addEventListener('click', (e) => {
          touchWakeEffect.showWakeEffect(e.clientX, e.clientY);
        });
      },

      // 显示唤醒波纹效果
      showWakeEffect: (x, y) => {
        const ripple = document.createElement('div');
        ripple.className = 'fixed rounded-full bg-white/20 animate-ping pointer-events-none';
        ripple.style.width = '0px';
        ripple.style.height = '0px';
        ripple.style.left = `${x}px`;
        ripple.style.top = `${y}px`;
        ripple.style.transform = 'translate(-50%, -50%)';
        ripple.style.zIndex = '999';
        
        document.body.appendChild(ripple);
        
        // 波纹动画
        setTimeout(() => {
          ripple.style.width = '300px';
          ripple.style.height = '300px';
          ripple.style.opacity = '0';
          ripple.style.transition = 'all 1.5s ease-out';
        }, 10);
        
        // 移除波纹元素
        setTimeout(() => ripple.remove(), 1600);
      }
    };
        // 9. 最终初始化所有模块（确保顺序执行）
    window.addEventListener('DOMContentLoaded', () => {
      // 优先初始化核心功能
      app.init();
      
      // 初始化增强动态效果（无点击持续运行）
      dynamicEffects.init();
      
      // 初始化性能优化
      performanceOptimization.init();
      
      // 初始化触摸唤醒效果（可选交互）
      touchWakeEffect.init();
      
      // 额外添加页面滚动防护（电视端防止意外滑动）
      document.addEventListener('touchmove', (e) => e.preventDefault(), { passive: false });
      
      // 控制台日志提示（调试用）
      console.log('Flyz远征飞智能桌面系统_V1.0.1 初始化完成');
    });
  </script>
</body>
</html>
    
